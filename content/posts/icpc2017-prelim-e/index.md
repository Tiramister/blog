---
title: "ICPC 2017 国内予選 E - 論理式圧縮機"
date: 2019-06-16
tags: [icpc]
links:
  - label: "Problem link"
    url: https://onlinejudge.u-aizu.ac.jp/challenges/sources/ICPC/Prelim/1620?year=2017
  - label: "My Submission"
    url: https://onlinejudge.u-aizu.ac.jp/status/users/misteer/submissions/1/1620/judge/3659639/C++14
---

## 問題

以下の BNF によって定義される、 4 変数の論理式が与えられる。

{{<code file="0.txt" language="txt" title="BNF">}}

ここで`-`、`*`、`^`はそれぞれ not、and、xor に当たる。

与えられた式と同値な論理式の長さの最小値を求めよ。

### 制約

- 論理式の長さは $16$ 以下

## 考察

与えられた論理式を同値なものに圧縮する、みたいなことを考えるとどツボにハマる。

そもそも「論理式が同値」というのは「a~d にどんな真理値を割り振っても、全体の真理値が合致する」ということである。よって全ての割り振りに対して真理値を求めれば、その対応表によって論理式を表現することができる(これを真理値表と呼ぶことにする)。割り振りのパターンは $2\^4 = 16$ 通りしかないので、真理値表は $2^16 = 32,776$ 通りしか存在しない。

後は論理式の各長さに対して、実現できる真理値表を全て求めればいい。これは長さの小さい方から、

- 長さを 1 増やして not をつける
- 長さを 3 増やして、2 つの真理値表を and か xor でくっつける

という遷移によって埋めることができる。

疑問なのは計算量だが、 and と xor の追加コストが大きいため十分小さくなる。

## 実装例

以下のコードでは、実装しやすいように文法を以下のように変換している。

{{<code file="1.txt" language="txt" title="変換後の BNF">}}

{{<code file="2.cpp" language="cpp">}}

構文解析にて 1 つ大きな注意点がある。
`bin`内の`ret = expr(i) && ret;`だが、これは順番を逆にすると短絡評価によって`expr(i)`が評価されないことがある。
一番確実なのは変数に格納することである。
