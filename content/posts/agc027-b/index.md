---
title: "AtCoder Grand Contest 027 B - Garbage Collector"
date: 2018-09-17
tags: [atcoder]
links:
  - label: "Problem"
    url: https://atcoder.jp/contests/agc027/tasks/agc027_b
  - label: "My Submission"
    url: https://atcoder.jp/contests/agc027/submissions/3216762
---

## 概要

数直線上に $N$ 個のゴミとゴミ箱とロボットが置かれている。
ゴミ箱とロボットは座標 0 に、 $i$ 番目のゴミは座標 $x\_i$ に置かれている。

これから、ロボットが数直線上を移動してゴミをゴミ箱へ捨てていく。動作にかかるエネルギーは以下の通り。

- ゴミを 1 つ拾うのと、ゴミを 1 回ゴミ箱に入れるのに $X$ 。
  - ゴミをいくつ同時に捨てても、消費するエネルギーは $X$ で変わらない。
- ゴミを $k$ 個持っているとき、1 移動するのに $(k + 1)\^2$ 。

また、一度拾ったゴミをゴミ箱以外に置くことはできない。

ロボットが $N$ 個のゴミを全てゴミ箱へ捨てるのに、消費するエネルギーの最小値を求めよ。

### 制約

- $1 \\leq N \\leq 2 \\times 10\^5$
- $0 \\lt x\_1 \\lt \\dots \\lt x\_N \\leq 10\^9$
- $1 \\leq X \\leq 10\^9$

## 解説

### 一度に $K$ 個回収するエネルギー

まず具体例として、「$K$ 個置かれているゴミをまとめてゴミ箱へ捨てる」ときの消費エネルギーを具体的に求める。

まず行動パターンだが、「一番奥まで行って、帰りがけに回収する」というのが最善となる。
これは道中でゴミを拾った場合、一番奥まで行ってそこに戻ってくるまでの間により多くのエネルギーを消費してしまうことから分かる。

では消費エネルギーを計算してみる。以下に $K = 4$ の場合を示す。

{{<image src="0.png">}}

手を動かして計算すると、消費エネルギーは以下のようになる。最後だけ $5$ が連続していることに注意。

$$
(2K + 1)x\_1 + (2K - 1)x\_2 + \\dots + (2K - 2i + 3)x\_i + \\cdots + 7x\_\{K - 2\} + 5x\_\{K - 1\} + 5x\_K
$$

### 往復回数を固定

では、往復回数 $t$ を固定したときのエネルギーの最小値について考えてみよう。
$t = 1$ は上で示した通りなので、次は $t = 2$ について考えてみる。

ただ式で考えると理解しづらいので、「**各変数についている係数**」を図示して考える。
具体的に $N = 10$ のときを考える。例えばこのとき、1 回目で後ろ 4 個、2 回目で残り 6 個を回収するという方法が考えられる(下図上)。

しかし、回収するゴミを交互にすることで大きい係数を手前にずらすことができるため、そちらの方が効率的である(下図中)。

さらに、回収するゴミの数を 2 回の往復で均一にすることで、全体の係数の最大値をより小さく抑えることができる(下図下)。

{{<image src="1.png">}}

これは $t \\gt 2$ でも同じ話で、例えば $t = 3$ なら以下のようになる。

{{<image src="2.png">}}

### 計算量の削減

これで往復回数を固定したときのエネルギーの最小値が分かったが、愚直に計算していると各 $t$ について計算量は $O(N)$ となり部分点しかとれない。

そこで、 $x$ の累積和を予め求めておくことで計算量を削減する。具体的には、右端を $t$ ずつ引きながら累積和を足し上げていけばいい(この辺は言葉で伝えるより下のコードを見た方がわかりやすいと思う)。

一見するとこれでも全体の計算量は $O(N\^2)$ から変わらないように見える。しかし、各 $t$ における計算量は正確には $O(N / t)$ であり、調和数列の近似

$$
\\frac\{1\}\{1\} + \\frac\{1\}\{2\} + \\dots + \\frac\{1\}\{N\} \\simeq \\log N
$$

から、全体の計算量は $O(N \\log N)$ まで落ちていることになる。これで満点が取れる。

## 実装例

一部の $t$ では 64bit 整数でもオーバーフローを起こす可能性があるため要注意(3 敗)。

{{<code file="0.cpp" language="cpp">}}
