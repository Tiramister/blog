---
title: "第一回日本最強プログラマー学生選手権決勝 E - Nearest String"
date: 2020-10-22
tags: [atcoder]
links:
  - label: "Problem link"
    url: "https://atcoder.jp/contests/jsc2019-final/tasks/jsc2019_final_e"
  - label: "My Submission"
    url: "https://atcoder.jp/contests/jsc2019-final/submissions/17571411"
---

## 問題

文字列に対する以下の 2 種類の操作を考える。

- 先頭または末尾から 1 文字削除する。このときコストが $X$ かかる。
- 末尾に任意の文字を 1 文字追加する。このときコストが $Y$ かかる。

$N$ 個の文字列 $\\\{ S\_i \\\}$ が与えられる。以下の形式のクエリを $Q$ 個処理せよ。

$j$ 番目のクエリでは文字列 $T\_j$ が与えられる。
$T\_j$ に上の 2 種類の操作を施すことでいずれかの $S\_i$ と一致させるとき、かかるコストの最小値を求めよ。

### 制約

- $1 \\leq N, Q \\leq 10\^5$
- $1 \\leq X, Y \\leq 10\^9$
- $\\sum |S\_i|, \\sum |T\_j| \\leq 5 \\cdot 10\^5$

## 考察

### $N=1$ の場合

まずは文字列 $T$ を $S$ に一致させるのにかかるコストの求め方を考える。
編集距離の DP と似たような考え方により、操作は実質的に以下の 2 種類と同等となる。

- $S$ の末尾から 1 文字削除する。このときコストが $Y$ かかる。
- $T$ の先頭または末尾から 1 文字削除する。このときコストが $X$ かかる。

よって $S\'$ を $S$ の接頭辞としたとき、 $S\'$ が $T$ に部分文字列として出現するなら一致させることができる。このときのコストは以下で求まる。

$$
\\begin\{align*\}
& Y(|S| - |S\'|) + X(|T| - |S\'|) \\\\
=& X|T| + Y|S| - (X + Y) |S\'|
\\end\{align*\}
$$

「 $S\'$ が $T$ に部分文字列として出現する」というのはパターンマッチングに他ならない。
よって $|S\'|$ の最大値は KMP 法により $\\Theta(|T|)$ で求められる。これで $N=1$ のケースは解くことができた。

### 一般の $N$ の場合

これを一般の $N$ へ拡張すると、パターンが複数に増える。
ということで複数パターンのマッチングが行える**Aho-Corasick 法**が使える。

$X|T| + Y|S| - (X + Y) |S\'|$ をよく見ると、 $T$ に依存する項と $S\'$ に依存する項が分離されている。よって Trie の各ノードに $Y|S| - (X + Y) |S\'|$ の最小値を持たせてやればよい。

## 実装例

Aho-Corasick 法をライブラリとして持っていれば、実装はちょっと中身を弄るだけで済む。

{{<code file="0.cpp" language="cpp">}}
