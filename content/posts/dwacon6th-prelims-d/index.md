---
title: "第 6 回 ドワンゴからの挑戦状 予選 D - Arrangement"
date: 2020-01-12
tags: [atcoder]
links:
  - label: Problem link
    url: https://atcoder.jp/contests/dwacon6th-prelims/tasks/dwacon6th_prelims_d
  - label: My Submission
    url: https://atcoder.jp/contests/dwacon6th-prelims/submissions/9474639
---

## 問題

長さ $n$ の順列 $\\\{ p\_i \\\}$ で，以下を満たすものが存在するか判定し，存在するなら 1 つ出力せよ．

- 任意の $1 \\leq i \\leq n$ に対し， $i$ の次は(存在すれば) $a\_i$ ではない．

### 制約

- $2 \\leq n \\leq 10\^5$
- $1 \\leq a\_i \\leq n$
- $a\_i \\neq i$

## 考察

後ろから決めることを考えると，「 $K$ 以外全部 $K$ を指している」ようなケースがまずいことに気づく．このとき $K$ 以外の値を先頭にすると，それ以降 $K$ が置けなくなってしまうからだ．

そこで，以下のような貪欲アルゴリズムを考えた．

- まだ決まっていないかつ直前に指されていない，最も小さい値を $x$ とする．
  - そのような値がない場合は NO．
- $a\_x$ がまだ決まっていないかつ， $a\_x$ 以外の決まっていない数が全て $a\_x$ を指していた場合， $x$ を $a\_x$ に変える．
- これは各値の指されている数を保持すれば判定できる．
- $x$ を解の末尾に追加し，カウント等を更新する．

これで概ね良いのだが，愚直解と突き合わせると $\\\{ 3, 1, 1, 1, 6, 5 \\\}$ のように最後 2 つが指し合っているケースなどで NO と判定してしまうことが分かる．このときの答えは $\\\{ 1, 2, 3, 5, 4, 6 \\\}$ で，最後 3 つでやりくりすると上手くいく．

これらを最後まで詰めるのは流石に厳しいと思い，「最後 $6$ 要素を全探索する」としたら通った．

## 実装例

最後の全探索は 3 要素でも通る．

{{<code file="0.cpp" language="cpp">}}
