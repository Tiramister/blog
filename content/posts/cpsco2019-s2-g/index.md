---
title: "CPSCO2019 Session2 G - MSTX"
date: 2019-11-01
tags: [voluntary]
links:
  - label: Problem link
    url: https://atcoder.jp/contests/cpsco2019-s2/tasks/cpsco2019_s2_g
  - label: My Submission
    url: https://atcoder.jp/contests/cpsco2019-s2/submissions/8234140
---

## 問題

$n$ 頂点 $m$ 辺の重み付き無向連結グラフが与えられる．
$i$ 番目の辺は $u\_i$ と $v\_i$ を結び，その重みは $w\_i$ である．
ここで $w\_i$ は定数か，変数 $x$ である．

$q$ 個のクエリが与えられる．
$j$ 番目のクエリは整数 $a\_j$ からなる．
このとき， $x = a\_j$ としたときの最小全域木の重みを求めよ．

### 制約

- $1 \\leq n \\leq 5 \\times 10\^4$
- $n - 1 \\leq m \\leq 5 \\times 10\^4$
- $w\_i$ が定数のとき， $1 \\leq w\_i \\leq 10\^9$
- $1 \\leq q \\leq 5 \\times 10\^4$
- $1 \\leq a\_j \\leq 10\^9$

## 考察

以降 $w\_i$ は昇順に並んでいるものとする( $x$ は末尾)．
また重みが定数の辺は $l$ 本あるとする．

Kruskal 法を軸に考える．
まず， $x$ の辺なしで Kruskal 法を行い， $i$ 本使った時点での連結成分数は $g\_i$ ，重みは $c\_i$ だったとする．
次に $x$ の辺を全部使ってから Kruskal 法を行い， $x$ でない辺を $i$ 本使った時点での連結成分数は $xg\_i$ ，重みは $xc\_i$ だったとする．

ここで $w\_\{i - 1\} \\leq a\_j \\leq w\_i$ だったとする(0-indexed)．
すると $x$ の辺は $i$ 本を追加した後で全部追加されることになる．
つまり答えは

- $i$ 本目までを追加
- $x$ の辺を一気に追加
- 残りの辺を全部追加

としたときの Kruskal 法の解となる．

1 番目は普通に $c\_i$ となる．

ここで重要な事実として，「 $i$ 本目まで追加してから $x$ の辺を追加」と「 $x$ の辺を追加してから $i$ 本目まで追加」でどちらも同じ森が得られる．
よって 3 番目は $xc\_l - xc\_i$ で求まる．

残るは 2 番目だが，これは $x$ の辺が何本使われたかが分かれば良い．
辺を 1 つ追加すると連結成分数が 1 減ることから，これは $g\_i - xg\_i$ で求まる．
「森の辺数 = 頂点数 - 連結成分数」と考えても良い．

$i$ の値は二分探索で求まるので，これで $\\Theta((n + q) \\log n)$ でこの問題が解けた．

## 実装例

{{<code file="0.cpp" language="cpp">}}
