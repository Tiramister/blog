---
title: "CPSCO2019 Session2 E - Mogu Mogu Gummi"
date: 2019-11-01
tags: [atcoder]
links:
  - label: Problem link
    url: https://atcoder.jp/contests/cpsco2019-s2/tasks/cpsco2019_s2_e
  - label: My Submission
    url: https://atcoder.jp/contests/cpsco2019-s2/submissions/8231839
---

## 問題

頂点 $0$ を根とする $n$ 頂点の根付き木が与えられる．
頂点 $v$ は頂点 $p\_v (\\lt v)$ と耐久力 $h\_v$ の辺で結ばれている．

この木に対して，以下の操作を好きな回数だけ行う．

- $0$ 以外で $0$ と連結な頂点 $v$ を 1 つ選ぶ．
- $0$ と $v$ を結ぶパス上の辺の耐久力を $1$ 減らす．
- 耐久力が $0$ になった辺は削除される．

最終的な連結成分数の最大値を求めよ．

### 制約

- $2 \\leq n \\leq 5 \\times 10\^3$
- $1 \\leq h\_i \\leq 10\^9$

## 考察

$dp\_\{v, k\} =$ 「 $v$ を根とする部分木を $k$ 個の連結成分に分解するとき， $v$ から上に伸びる辺にかかるダメージの最小値」という DP を考える．
これは $v$ の各子 $u$ に対して再帰的に $dp\_u$ を求めて， $v$ と $u$ を切るかどうかの処理をして，それらを左からマージしていくことで求められる．

気になるのは計算量だが，実はこれが $\\Theta(n\^2)$ になるというのが俗に言う「木の二乗 DP」である．これを簡単に示す．

{{<collapse summary="計算量の証明">}}
$v$ の子をそれぞれ $u\_1, \\cdots, u\_k$ として， $u\_i$ を根とする部分木のサイズを $s\_i$ とする．また頂点 $v$ を根とする部分木のサイズを $n$ とする．

長さ $s, t$ の DP 配列のマージに時間 $2st$ かかるとき[^1]，左から順にマージしていくと全体の計算量は

[^1]: 係数の $2$ は後々計算が楽なのでつけてあるだけ．

$$
2 s\_1 s\_2 + 2 (s\_1 + s\_2) s\_3 + \\cdots + 2 (s\_1 + \\cdots + s\_\{k - 1\}) s\_k
= 2 \\sum\_\{i \\lt j\} s\_i s\_j
= \\left( \\sum\_\{i\} s\_i \\right)\^2 -  \\sum\_\{i\} \{s\_i\}\^2
$$

となる．そして $u\_i$ を根とする部分木に対して DP 配列を求めるのに $\{s\_i\}\^2$ 時間かかるとすると，右辺の第 2 項が消えて $\\left( \\sum\_\{i\} s\_i \\right)\^2 = n^2$ が残る．
{{</collapse>}}

## 実装例

{{<code file="0.cpp" language="cpp">}}
