---
title: "Codeforces Round 616 C - Prefix Enlightenment"
date: 2020-02-03
tags: [codeforces]
links:
  - label: "Problem link"
    url: "https://codeforces.com/contest/1290/problem/C"
  - label: "My Submission"
    url: "https://codeforces.com/contest/1290/submission/70086225"
---

## 問題

0, 1 の 2 状態を持つ $n$ 個のライトがあり， $s\_i$ がライト $i$ の初期状態を表す．

また，ライトを操作するための $k$ 個のスイッチがある． $i$ 番目のスイッチはライト $a\_\{i, 1\}, \\cdots, a\_\{i, c\_i\}$ の状態を全て反転させる．
ただし， $A\_i = \\\{ a\_\{i, j\} \\mid 1 \\leq j \\leq c\_i \\\}$ としたとき，任意の $1 \\leq i\_1 \\lt i\_2 \\lt i\_3 \\leq k$ について $A\_\{i\_1\} \\cap A\_\{i\_2\} \\cap A\_\{i\_3\} = \\emptyset$ となる．

各 $i = 1, \\cdots, n$ について，ライト $1, \\cdots, i$ を全て 1 にするために押す必要があるスイッチの最小個数を求めよ．与えられる入力では，スイッチを適当に選ぶことで全てのライトを 1 にできることが保証される．

### 制約

- $1 \\leq n, k \\leq 3 \\cdot 10\^5$
- 集合に関する制約から， $\\sum c\_i \\leq 2n$

## 考察

集合に関する制約から，各ライトについてそれを反転させるスイッチは高々 2 つであることが分かる．ここから，スイッチ間に選ぶ・選ばないの制約を課していくことができる．

ライト $i$ を反転させるスイッチが 1 つのとき，そのスイッチを $v$ とする．このとき， $s\_i$ によって $v$ を選ぶべきか否かが決まる．

ライト $i$ を反転させるスイッチが 2 つのとき，そのスイッチを $u, v$ とする．このとき， $s\_i = 0$ なら $u, v$ の選ぶ・選ばないは一致していなければならず， $s\_i = 1$ なら逆に一致していてはならない．

そこで，各スイッチを頂点，選び方の制約を辺とする無向グラフを考える．具体的には，上のケースで頂点 $u, v$ 間に重み $s\_i$ の辺を張る．
このとき「集合 $S$ を選ぶと全てのライトが 1 になる」ことと，「 $(S, V \\backslash S)$ は**2 色塗り分け**である」，すなわち「各 $S, V \\backslash S$ について，集合内の任意の 2 点間の距離は偶数である」と同値となる．

そしてこの 2 色塗り分けは，各連結成分毎に独立に考えることができる．連結成分内に「選ぶべきか」が強制されている頂点があれば，それが属する集合を選ぶべき．なければサイズが小さい集合を選ぶのが最善となる．

これを(Weighted) Union Find で管理してやればいい．具体的には，各根について

- 2 色塗り分けの各集合のサイズ
- どちらの集合を選ぶべきか，あるいはどちらを選んでも良いか

を追加で持つようにする．マージは距離に応じてマージされる側の色を反転させ，サイズを足し合わせれば良い．

## 実装例

経路圧縮をサボったが，マージテクにより $O(n \\log k)$ で動く．結構際どかった．

{{<code file="0.cpp" language="cpp">}}
