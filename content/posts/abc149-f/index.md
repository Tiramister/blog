---
title: "AtCoder Beginner Contest 149 F - Surrounded Nodes"
date: 2019-12-29
tags: [atcoder]
links:
  - label: Problem link
    url: https://atcoder.jp/contests/abc149/tasks/abc149_f
  - label: My Submission
    url: https://atcoder.jp/contests/abc149/submissions/9227350
---

## 問題

$n$ 頂点の木が与えられる．

今からこの木の各頂点を，独立に確率 $\\frac\{1\}\{2\}$ で黒か白に塗る．
塗り終わった後，黒い頂点を全て含む最小の部分木 $S$ を取る．

このとき， $S$ に含まれる白い頂点の個数の期待値を求めよ．

### 制約

- $2 \\leq n \\leq 2 \\times 10\^5$

## 考察

期待値問題の常套手段として，代わりに $p\_v =$ 「頂点 $v$ が白く塗られ，かつ $S$ に含まれる確率」を求めることにする．すると答えは $\\sum p\_v$ となる．
ただ，ここでは $p\_v$ の代わりに求めやすい「頂点 $v$ が白く塗られ，かつ $S$ に含まれない確率」を求めることにする．

木から頂点 $v$ を取り除くと，いくつかの部分木 $T\_1, \\cdots, T\_k$ へと分解される．このとき「 $v$ が $S$ に含まれない」ことは，「 $T\_1, \\cdots, T\_k$ のうち黒い頂点を含むものが 1 つ以下である」ことと同値となる。

黒い頂点を含む $T\_i$ が 1 つもない確率は、全頂点が白である場合のみなので $2\^\{-n\}$ ．黒い頂点を含む $T\_i$ がちょうど 1 つである確率は，各 $i$ について「 $T\_i$ が黒い頂点を少なくとも 1 つ含み，他は全部白の確率」を足し上げればよく，これは

$$
\\sum\_\{i=1\}\^\{k\} \\frac\{1\}\{2\^\{n - |T\_i|\}\} \\cdot
\\left(1 - \\frac\{1\}\{2\^\{|T\_i|\}\} \\right)
$$

で求まる．

よって後は各 $v$ について $|T\_1|, \\cdots, |T\_k|$ が求まればよく，これは DFS により全体で $O(n)$ で計算できる．

## 実装例

{{<code file="0.cpp" language="cpp">}}
