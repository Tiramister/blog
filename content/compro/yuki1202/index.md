---
title: "yukicoder No.1202 お菓子の食べ方"
date: 2020-08-30
tags: [yukicoder]
links:
  - label: "Problem link"
    url: "https://yukicoder.me/problems/no/1202"
  - label: "My Submission"
    url: "https://yukicoder.me/submissions/544853"
---

## 問題

$n \\times m$ 行列 $(a\_\{i,j\})$ が与えられる。この行列は全ての $1 \\leq i \\leq n, 1 \\leq j \\leq m$ に対して $a\_\{i,j\} \\geq a\_\{i+1,j\}, \\; a\_\{i,j\} \\geq a\_\{i,j+1\}$ を満たす(範囲外の要素は $0$ とみなす)。

これから行列の全ての要素が $0$ になるまで以下のうちどれか 1 つの操作を行う。

- 操作 A: $0$ でない要素全てから $1$ を引く。
- 操作 B: 各行の最も大きい要素(複数ある場合は最左のもの)を $0$ にする。
- 操作 C: 総和が最も大きい行(複数ある場合は最上のもの)の全要素を $0$ にする。

このような操作列の個数を求めよ。

### 制約

- $1 \\leq n, m \\leq 10\^3$
- $1 \\leq a\_\{i, j\} \\leq 10\^6$

## 考察

### 言い換え

まず $a\_\{i,j\} \\geq a\_\{i+1,j\}, \\; a\_\{i,j\} \\geq a\_\{i,j+1\}$ から、操作 B(C)は本質的にはそれぞれ「最左(最上)の列(行)を削る」と等価であることが分かる。さらにそうして削られた行列の最大要素が左上であることを考慮すると、問題は以下のように言い換えられる。

> $n \\times m$ 行列 $(a\_\{i,j\})$ が与えられる(性質は略)。また行列の左上 $(0, 0)$ にコマが 1 つ置かれている。
>
> これからコマの置かれている要素が $0$ になるまで以下のうちどれか 1 つの操作を行う。ただし行列の範囲外の要素は全て $0$ とみなす。
>
> - 操作 A: $0$ でない要素全てから $1$ を引く。
> - 操作 B: コマを 1 つ右に動かす。
> - 操作 C: コマを 1 つ下に動かす。
>
> このような操作列の個数を求めよ。

コマは常に「削られた行列の左上」、つまり「残っている要素の最大値」を指している。よってコマの置かれた要素が $0$ になっているとき、全ての要素はすでに $0$ になっているというわけである。

### 数え上げ

以降コマが最後の操作の直前にいる場所 $(i, j)$ 、最後に行った操作によって場合分けを行う。ここで最後の操作を除いて操作 B, C を行った回数はそれぞれ $i, j$ であることに注意。

#### 最後が操作 A の場合

この場合操作 A の回数は $a\_\{i, j\}$ 回となり、操作 A が最後であればどんな操作列も OK となる。よってその通り数は多項係数によって以下のように表せる。

$$
\\binom\{i + j + a\_\{i, j\} - 1\}\{i, j, a\_\{i, j\} - 1\}
$$

#### 最後が操作 B の場合

$s = a\_\{i, j\}, t = a\_\{i, j + 1\}$ とする。

この場合、操作 A の回数は $t$ 以上 $s$ 未満でなくてはならない。一方それさえ満たしていればどんな操作列も OK となる。よってその通り数は多項係数によって以下のように表せる。

$$
\\begin\{align\}
   \\sum\_\{x=s\}\^\{t-1\} \\binom\{i+j+x\}\{i, j, x\}
   &=
   \\binom\{i+j\}\{i\} \\sum\_\{x=s\}\^\{t-1\} \\binom\{i+j+x\}\{x\} \\\\
   &=
   \\binom\{i+j\}\{i\} \\left( \\binom\{i+j+t\}\{t-1\} - \\binom\{i+j+s\}\{s-1\} \\right)
\\end\{align\}
$$

#### 最後が操作 C の場合

$s = a\_\{i, j\}, t = a\_\{i+1, j\}$ とすると、先程と全く同じである。

## 実装例

{{<code file="0.cpp" language="cpp">}}
