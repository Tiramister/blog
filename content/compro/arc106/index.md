---
title: "AtCoder Regular Contest 106"
date: 2020-10-25
tags: [atcoder, arc]
links:
  - label: "Contest link"
    url: "https://atcoder.jp/contests/arc106"
---

## 結果

|      |  A   |  B   |   C   |   D   |   E   |  F  |
| :--: | :--: | :--: | :---: | :---: | :---: | :-: |
| time | 2:41 | 7:26 | 16:56 | 26:10 | 86:44 |  -  |
|  Δ   | 2:41 | 4:46 | 9:30  | 9:14  | 60:34 |  -  |

## 問題

### A - 106

即 Python で実装することを決めた。
オーバーフローとか何も考えずに $1 \leq A, B \lt 60$ を全探索できて楽。

ただプログラムの終了方法を忘れかけていた。`exit()`を使って変なことになった記憶があるので`sys.exit()`を使ったが、どうだったか。

### B - Values

「総和比べるだけでは」と思ったがそんな問題が出るわけもなく、問題文に「連結」とは書かれていないことを確認する。後は DSU でおしまい。

### C - Solutions

高橋解法は最適解なので、 $M \lt 0$ は不可能。
また、どっちも少なくとも 1 つは選べるので $M = N$ も不可能。

なぜ青木解法が間違っているのかを考えると、左端が最小の区間がとても長いケースが思いつく。
この長い区間に $M+1$ 個の disjoint な短い区間を被せて、残りを後ろに並べれば OK。

それを実装して投げると OLE(コンテスト中に出したのは多分初)。
色々試すと $N = M-1$ で無限ループし、 $M = N-1$ でも不可能であることに気づく。

そこを修正して投げると 1WA。
さらに小さいケースをいくつか試して、例の $(1, 0)$ のケースに気づき AC。

### D - Powers

「 $\sum\_\{L=1\}\^\{N\} \sum\_\{R=1\}\^\{N\} \{A\_L\}\^i \{A\_R\}\^j =
\left( \sum\_\{L=1\}\^\{N\} \{A\_L\}\^i \right)
\left( \sum\_\{R=1\}\^\{N\} \{A\_R\}\^j \right)$
みたいな高速化はよく見るよな〜」という潜在意識からか、2 項定理で展開することを思いつく。

ただ、そのままでは非対称性からあまり高速にならない。
手元で式を弄った結果、 $\sum\_\{L=1\}\^\{N\} \sum\_\{R=1\}\^\{N\} (A\_L + A\_R)\^X$ に帰着して対称性を持たせることを思いつく。

式さえ立てば実装は簡単。

### E - Medals

EF を行ったり来たりした結果、E に集中することを決意。

$N=18$ という制約から、最初「人の間に適当な優先順位をつけて、貪欲にメダルを割り当てたものが最適解になる」という予想を立てていた。
しかし TSP のような DP ができない上に、 $K=2, (A\_i) = (2, 3)$ のケースで最適解を達成できないことに気づく。

基本に戻って愚直解から考えると、最大流問題に帰着できることが分かる。
さらにしばらく唸っていると、フローグラフが最大 2 部マッチングの形をしていることから、**Hall の結婚定理**を適用できることに突然気づく。

日数 $D$ で二分探索することを考える。
各 $S \subseteq [N]$ について $a\_S=$ 「ちょうど $S$ に属する人のみがいる日数」というのは、前計算すれば $\Theta(D)$ で求まる。
Hall の結婚定理を適用するには、ここから各 $S \subseteq [N]$ について $d\_S=$ 「 $S$ のうち少なくとも 1 人がいる日数」というのを求める必要がある。しかしこれを愚直にやると $\Theta(4\^N)$ かかってしまう。

そこで「少なくとも 1 人がいる」というのを解消すべく、補集合を取ることにする。
つまり $\tilde\{a\}\_S=$ 「ちょうど $S$ に属する人のみが**いない**日数」を計算してから、 $\tilde\{d\}\_S=$ 「 $S$ に属する人が誰もいない日数」を求める。
すると $(\tilde\{d\}\_S)$ は $(\tilde\{a\}\_S)$ に(上位集合の)**ゼータ変換**を施したものになる。よって高速ゼータ変換によって $\Theta(N 2\^N)$ で $(\tilde\{d\}\_S)$ を計算できる。

最後に $D$ の上界が問題となってくる。
もう時間もなかったので、「 $NK$ よりそこまで大きくならないだろう」と信じ、 $5 \cdot 10\^6$ を上界にしたら無事通った。ちなみに Hall の結婚定理を使うと、 $2NK$ で抑えられることが分かる。

### F - Figures

木を 1 つ固定して考える。頂点 $v$ の次数を $a\_v$ とすると、フィギュアの個数は以下で求まる。

$$
\prod\_\{v\} \{\}\_\{d\_v\} P\_\{a\_v\}
$$

そこからしばらく進まなかったのだが、「次数列 木」で検索するとが見つかる。
[本質情報](https://mathmatik.jp/2018/10/18/cayley_theorem1/) 曰く、次数列が $(a\_v)$ であるような木の個数は以下で求まるという。

$$
\frac\{(n-2)!\}\{\prod\_\{v\} (a\_v-1)!\}
$$

これを組み合わせると、以下の式で解が求まる。

$$
(N-2)! \cdot \sum\_\{\sum a\_v = 2(n-1)\} \prod\_v \binom\{d\_v\}\{a\_v\} a\_v
$$

しかしこれを整理できないままコンテストが終わった。一応

$$
f\_v(x) = \sum\_\{k\} \binom\{d\_v\}\{k\} k x\^k
$$

という形式的冪級数を考えると、 $(N-2)![x\^\{2(N-1)\}] \prod\_v f\_v(x)$ で答えが出るな〜とは思ったが、 $O(N\^2 \log N)$ かかるので論外。ちなみに未だに答えは分かっていない。

【追記】(熨斗袋さん、ありがとうございます)

積分と二項係数を使うと、上の形式的冪級数が整理できる。

$$
F\_v(x) = \sum\_\{k\} \binom\{d\_v\}\{k\} x\^k = (1 + x)\^\{d\_v\}
$$

としたとき、

$$
f\_v(x) = x F\_v\'(x) = d\_v x (1 + x)\^\{d\_v - 1\}
$$

となる。よって答えは

$$
\begin\{aligned\}
(N-2)! [x\^\{2(N-1)\}] \prod\_v f\_v(x)
   \&= (N-2)! [x\^\{2(N-1)\}] \prod\_v d\_v \cdot x\^N (1 + x)\^\{\sum\_v d\_v - N\} \\\\
   &= (N-2)! \prod\_v d\_v \cdot [x\^\{N-2\}] (1 + x)\^\{\sum\_v d\_v - N\} \\\\
   &= (N-2)! \prod\_v d\_v \cdot \binom\{\sum\_v d\_v - N\}\{N-2\} \\\\
   &= \prod\_v d\_v \cdot \{\}\_\{\sum\_v d\_v - N\} P\_\{N-2\}
\end\{aligned\}
$$

となる。

## 反省

- C の $(1, 0)$ はしょうがないと思うが、その前の 1 ペナは駄目。なぜ $N=5$ 辺りで全入力試さなかったのか。
- D は二項定理が即座に出てきたので良かった。しかし対称な形に帰着するのがやや遅かった。
- E は普通に難しいので、解けただけ偉いと思う。Hall の結婚定理を「降ってくる」じゃなくて「自然に適用できる」ものにしたい。
- F はもっと早く「次数列 木」で検索すべきだった。結局その後が整理できていないのも残念。
