---
title: "Codeforces Round #680 (Div. 1)"
date: 2020-11-02
tags: [codeforces, div1]
links:
  - label: Contest link
    url: http://codeforces.com/contest/1444
---

## 結果

|      |  A   |   B   |   C    |  D  |  E  |
| :--: | :--: | :---: | :----: | :-: | :-: |
| time | 8:21 | 20:03 | 102:08 |  -  |  -  |
|  Δ   | 8:21 | 11:42 | 90:26  |  -  |  -  |

## 問題

### A. Division

$p$ が $q$ の倍数でないなら $x=p$ が答え。以降 $p$ は $q$ の倍数とする。

$q = \prod\_\{i\} \{b\_i\}\^\{e\_i\}$ と素因数分解されるとする。
このとき「 $x$ が $q$ の倍数でない」というのは、「ある $i$ が存在して $x$ は $b\_i\^\{e\_i\}$ の倍数でない」と同値である。
$x$ は極力大きくしたいので、他の素因数はイジらず、 $b\_i$ の指数だけ $e\_i - 1$ にするのが最善となる。これを全ての $i$ について試せばよい。

### B. Divide and Sum

以降 $a$ は昇順とする。
ある $a\_i$ に着目し、 $+a\_i$ として足される分け方と $-a\_i$ として足される分け方をそれぞれ高速に求めたい。

$a\_i$ が $p$ に属し、 $p$ の中で小さい方から $k$ 番目だったとする。
これが $-a\_i$ として足される、つまり $q$ の大きい方から $k$ 番目が $a\_i$ より後ろにある条件を頑張って整理する。
すると $i \leq n$ という綺麗な条件が出てくる。つまり分け方に依らず、 $a\_i$ が前半分にあるか否かだけで符号が決まるのである。 $a\_i$ が $q$ に属する場合も同じ条件になる。

よって(後半の総和)-(前半の総和)に分け方 $\binom\{2n\}\{n\}$ を掛けたものが答えになる。

### C. Team-Building

グループをマージできる条件は「誘導部分グラフが 2 部グラフである」と言い換えられる。
2 部グラフ判定の方法として、以下の 2 つがある。

- DFS で実際に 2 色に塗る
- 頂点を 2 つに倍加して、DSU で適当に辺を張り、矛盾がないか調べる

これを全ての組に対して行えば、 $O(n\^3)$ の愚直解が得られる。

グループ単体で 2 部グラフになってないグループは除外して考える。
すると、ある 2 つのグループがマージできないとき、この 2 つのグループを端点に持つ辺が存在する。
よってマージできないペアは $O(m)$ 個と分かり、計算量が $O(nm)$ に落ちる。

ある 2 つのグループに着目したとき、本質的なのは「2 つのグループを端点に持つ辺」である。
もしこれらのみを見て二部グラフ判定ができれば、全体の計算量は $O(m)$ になる。
実際、以下のようにしてこれができる。

まず前処理として、DSU を使って同じ色からなる連結成分に分解する。
そして各連結成分を、代表元を 0 として 0,1 の 2 色で塗り分ける。

この結果を使って二部グラフ判定をする。
2 つのグループを端点に持つ辺を見て、もし両端が同じ色だったら代表元は異なる色でないといけない。このような関係を列挙したとき、各連結成分の代表元を矛盾なく 0, 1 で塗れるかが分かればよい。
これは DSU を使った判定方法により、ほぼ線形時間で可能。

この判定に使う DSU を毎回リセットすると $O(nm)$ 掛かってしまう。
しかし変化があった頂点のみをリセットすることで、リセットの計算量を $O(m)$ に抑えられる。

これを読んで解法を理解してもらえるとは思っていないが、まぁ実装が重い。
システスで結構落ちたらしいので、ちゃんと実装できてよかった。

## 反省

- B の証明に結構時間がかかった。なんかもっと簡単な考え方がありそうな気がする。
- C は考察も実装もかなり遅い。Codeforces 力(？)が鈍ってるのを実感した。
